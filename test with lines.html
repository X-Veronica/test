<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>25-26T1 Week1-NewVocab-FIXED</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles to enhance Tailwind defaults and ensure responsiveness */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f8f8;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        /* Styles for the modal backdrop */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        /* Styles for the modal content */
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            text-align: center;
            max-width: 500px;
            width: 90%;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Custom container for positioning the canvas */
        .quiz-columns-container {
            position: relative; 
            /* ä¿®æ­£ 1: ç¡®ä¿å®¹å™¨é«˜åº¦è¶³å¤Ÿï¼Œä»è€Œå¯ä»¥ç§»é™¤æ»šåŠ¨æ¡ */
            min-height: 500px; 
        }

        /* ä¿®æ­£ 2: ç§»é™¤æ»šåŠ¨æ¡ */
        .column {
            /* ç¡®ä¿å†…å®¹ä¸ä¼šæ»šåŠ¨ï¼Œé¿å…åæ ‡é”™ä½ */
            overflow: hidden !important; 
            min-height: 500px !important; 
        }

        /* Canvas for drawing lines */
        #lineCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10; 
        }
    </style>
</head>
<body class="selection:bg-blue-200">
    <div id="quiz-main-container" class="bg-white p-6 md:p-10 rounded-xl shadow-lg w-full max-w-4xl space-y-6">
        <div class="text-center space-y-4">
            <h1 id="dateHeading" class="text-3xl md:text-4xl font-extrabold text-gray-800">IELTS Vocabulary Matching Quiz (15 words)</h1>
            <div id="timer" class="text-4xl font-bold text-blue-600">04:00</div>
            <input type="text" id="studentName" placeholder="Enter your name"
                   class="w-full md:w-1/2 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-center text-lg shadow-sm"
                   aria-label="Student Name">
        </div>

        <div class="quiz-columns-container flex flex-col md:flex-row justify-between gap-6">
            
            <canvas id="lineCanvas"></canvas>

            <div class="column flex-1 bg-yellow-50 p-4 rounded-lg shadow-md min-h-[500px] border border-yellow-200" id="wordColumn">
                </div>
            <div class="column flex-1 bg-blue-50 p-4 rounded-lg shadow-md min-h-[500px] border border-blue-200" id="definitionColumn">
                </div>
        </div>

        <div class="flex flex-col md:flex-row justify-center gap-4 mt-6">
            <button id="submitButton" onclick="submitQuiz()"
                    class="px-8 py-4 bg-gray-300 text-gray-700 font-semibold rounded-lg shadow-md transition-all duration-300 ease-in-out
                           hover:bg-green-600 hover:text-white focus:outline-none focus:ring-4 focus:ring-green-300 text-lg cursor-not-allowed"
                    disabled>
                Submit Quiz
            </button>
            <button id="resetButton" onclick="resetQuiz()"
                    class="px-8 py-4 bg-red-400 text-white font-semibold rounded-lg shadow-md transition-all duration-300 ease-in-out
                           hover:bg-red-600 focus:outline-none focus:ring-4 focus:ring-red-300 text-lg">
                Reset Quiz
            </button>
        </div>
    </div>

    <div id="customModal" class="modal-backdrop hidden">
        <div class="modal-content">
            <h2 id="modalTitle" class="text-2xl font-bold mb-4 text-gray-800"></h2>
            <div id="modalMessage" class="text-base text-gray-700 leading-relaxed mb-6 whitespace-pre-line text-left"></div>
            <button onclick="closeModal()"
                    class="px-6 py-3 bg-blue-500 text-white font-semibold rounded-lg shadow-md transition-all duration-300 ease-in-out
                           hover:bg-blue-600 focus:outline-none focus:ring-4 focus:ring-blue-300 text-lg">
                Close
            </button>
        </div>
    </div>

    <script>
        // --- ç”¨æˆ·çš„æ›´æ–°è¯æ±‡æ•°æ® ---
        const vocabulary = [
            { word: "conceal", definition: "éšè—" },
            { word: "claim", definition: "å£°ç§°" },
            { word: "tone", definition: "è¯­æ°”" },
            { word: "range", definition: "èŒƒå›´" },
            { word: "import", definition: "è¿›å£" },
            { word: "pledge", definition: "ä¿è¯" },
            { word: "thrive", definition: "ç¹è£" },
            { word: "starve", definition: "æŒ¨é¥¿" },
            { word: "imply", definition: "æš—ç¤º" },
            { word: "density", definition: "å¯†åº¦" },
            { word: "strain", definition: "å‹åŠ›" },
            { word: "leap", definition: "è·³è·ƒ" },
            { word: "scold", definition: "è´£éª‚" },
            { word: "perceive", definition: "å¯Ÿè§‰" },
            { word: "stimulate", definition: "åˆºæ¿€" },
            { word: "digest", definition: "æ¶ˆåŒ–" },
            { word: "prior", definition: "å…ˆå‰çš„" },
            { word: "urge", definition: "å‚¬ä¿ƒ" },
            { word: "obligation", definition: "ä¹‰åŠ¡" },
            { word: "panic", definition: "ææ…Œ" },
            { word: "spare", definition: "é¥¶æ•" },
            { word: "crucial", definition: "è‡³å…³é‡è¦çš„" },
            { word: "digital", definition: "æ•°å­—çš„" },
            { word: "glance", definition: "ç¥ä¸€çœ¼" },
            { word: "resume", definition: "æ¢å¤" },
            { word: "retreat", definition: "æ’¤é€€" },
            { word: "fade", definition: "è¤ªè‰²" },
            { word: "tender", definition: "æ¸©æŸ”çš„" },
            { word: "harmony", definition: "å’Œè°" },
            { word: "appeal", definition: "å‘¼å" },
            { word: "manual", definition: "æ‰‹å·¥çš„" },
            { word: "appetite", definition: "é£Ÿæ¬²" },
            { word: "convert", definition: "è½¬æ¢" },
            { word: "pump", definition: "æŠ½æ°´" },
            { word: "counsel", definition: "å»ºè®®" },
            { word: "renovate", definition: "ç¿»æ–°" },
            { word: "liberal", definition: "è‡ªç”±çš„" },
            { word: "remote", definition: "é¥è¿œçš„" },
            { word: "facility", definition: "è®¾æ–½" },
            { word: "peculiar", definition: "å¥‡æ€ªçš„" },
            { word: "stem", definition: "æºäº" },
            { word: "margin", definition: "è¾¹ç¼˜" },
            { word: "block", definition: "é˜»ç¢" },
            { word: "infect", definition: "æ„ŸæŸ“" },
            { word: "illusion", definition: "å¹»è§‰" },
            { word: "fierce", definition: "å‡¶çŒ›çš„" },
            { word: "strip", definition: "å‰¥å»" },
            { word: "fuss", definition: "å¤§æƒŠå°æ€ª" },
            { word: "tremendous", definition: "å·¨å¤§çš„" },
            { word: "exploit", definition: "åˆ©ç”¨" },
            { word: "recession", definition: "è¡°é€€" },
            { word: "hinder", definition: "é˜»ç¢" },
            { word: "context", definition: "èƒŒæ™¯" },
            { word: "prospect", definition: "å‰æ™¯" },
            { word: "inevitable", definition: "ä¸å¯é¿å…çš„" },
            { word: "discrimination", definition: "æ­§è§†" },
            { word: "optimism", definition: "ä¹è§‚" },
            { word: "postpone", definition: "æ¨è¿Ÿ" },
            { word: "incentive", definition: "æ¿€åŠ±" },
            { word: "victim", definition: "å—å®³è€…" },
            { word: "inspire", definition: "é¼“èˆ" },
            { word: "virtual", definition: "è™šæ‹Ÿçš„" },
            { word: "dare", definition: "æ•¢äº" },
            { word: "in that", definition: "å› ä¸º" },
            { word: "vague", definition: "æ¨¡ç³Šçš„" },
            { word: "capacity", definition: "èƒ½åŠ›" },
            { word: "discard", definition: "ä¸¢å¼ƒ" },
            { word: "incident", definition: "äº‹ä»¶" },
            { word: "instinct", definition: "æœ¬èƒ½" },
            { word: "rank", definition: "ç­‰çº§" },
            { word: "emerge", definition: "å‡ºç°" },
            { word: "coordinate", definition: "åè°ƒ" },
            { word: "temporary", definition: "ä¸´æ—¶çš„" },
            { word: "aviation", definition: "èˆªç©º" },
            { word: "detect", definition: "ä¾¦æµ‹" },
            { word: "slim", definition: "è‹—æ¡çš„" },
            { word: "retain", definition: "ä¿ç•™" },
            { word: "latter", definition: "åè€…çš„" },
            { word: "poverty", definition: "è´«ç©·" },
            { word: "bargain", definition: "äº¤æ˜“" },
            { word: "orbit", definition: "è½¨é“" },
            { word: "dismiss", definition: "è§£é›‡" },
            { word: "constitute", definition: "æ„æˆ" },
            { word: "reverse", definition: "é¢ å€’" },
            { word: "evolve", definition: "è¿›åŒ–" },
            { word: "fatigue", definition: "ç–²åŠ³" },
            { word: "dispose", definition: "å¤„ç†" },
            { word: "confront", definition: "é¢å¯¹" },
            { word: "dilemma", definition: "å›°å¢ƒ" },
            { word: "abundant", definition: "ä¸°å¯Œçš„" },
            { word: "wander", definition: "æ¼«æ­¥" }
        ];
        // --- è¯æ±‡æ•°æ®ç»“æŸ ---

        const QUIZ_WORD_COUNT = 15; 

        let selectedWord = null;
        let matchedPairs = new Map();
        let startTime;
        let timerInterval;
        const totalTime = 240; // 4 minutes
        let remainingTime = totalTime;
        let quizActive = false;

        // --- Line Drawing Variables and Setup ---
        const canvas = document.getElementById('lineCanvas');
        const ctx = canvas.getContext('2d');
        const columnsContainer = document.querySelector('.quiz-columns-container');
        
        let lineData = null; 
        const matchLines = new Map(); 

        // Function to initialize or reset the quiz
        function initQuiz() {
            // Clear existing elements
            document.getElementById('wordColumn').innerHTML = '';
            document.getElementById('definitionColumn').innerHTML = '';
            matchedPairs.clear();
            selectedWord = null;
            document.getElementById('submitButton').classList.remove('bg-green-500', 'hover:bg-green-600', 'text-white');
            document.getElementById('submitButton').classList.add('bg-gray-300', 'text-gray-700');
            document.getElementById('submitButton').disabled = true;
            document.getElementById('studentName').value = '';
            
            matchLines.clear();
            clearLine(); 
            if (selectedWord) {
                selectedWord.classList.remove('bg-green-400', 'border-green-500'); 
                selectedWord.classList.add('bg-yellow-200', 'border-yellow-300');
            }


            document.getElementById('dateHeading').textContent = 'IELTS Vocabulary Matching Quiz (' + QUIZ_WORD_COUNT + ' words)';

            const selectedWordsData = shuffleArray(vocabulary).slice(0, QUIZ_WORD_COUNT);
            const correctDefinitionsData = selectedWordsData.map(item => item.definition);

            const allDefinitions = shuffleArray(correctDefinitionsData);

            selectedWordsData.forEach(item => {
                const div = document.createElement('div');
                div.className = 'word p-3 mb-2 rounded-lg cursor-pointer transition-all duration-200 ease-in-out ' +
                                 'bg-yellow-200 hover:bg-yellow-300 shadow-sm border border-yellow-300';
                div.textContent = item.word;
                div.dataset.definition = item.definition;
                div.addEventListener('click', handleWordClick);
                div.addEventListener('dblclick', handleWordDoubleClick);
                document.getElementById('wordColumn').appendChild(div);
            });

            allDefinitions.forEach(definition => {
                const div = document.createElement('div');
                div.className = 'definition p-3 mb-2 rounded-lg cursor-pointer transition-all duration-200 ease-in-out ' +
                                 'bg-blue-200 hover:bg-blue-300 shadow-sm border border-blue-300';
                div.textContent = definition;
                div.addEventListener('click', handleDefinitionClick);
                document.getElementById('definitionColumn').appendChild(div);
            });

            resizeCanvas();
            startTimer();
            quizActive = true;
        }

        // Resizes the canvas to match the columns container dimensions
        function resizeCanvas() {
            const rect = columnsContainer.getBoundingClientRect();
            // Set canvas size to match the container's *client* size
            canvas.width = columnsContainer.clientWidth; 
            canvas.height = columnsContainer.clientHeight;
        }

        // Helper function to get the center-right or center-left coordinates of an element
        function getElementLinePoint(element, isWord) {
            const rect = element.getBoundingClientRect();
            const containerRect = columnsContainer.getBoundingClientRect();
            // Crucial: Subtract the container's top/left position from the element's top/left 
            // to get coordinates relative to the canvas origin (0,0).
            const x = isWord ? rect.right - containerRect.left : rect.left - containerRect.left;
            const y = rect.top + rect.height / 2 - containerRect.top;
            return { x, y };
        }

        // Clears the canvas entirely and resets lineData
        function clearLine() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            lineData = null; 
            drawMatchedLines(); 
        }

        // Draws a single active line (from a selected word)
        function drawActiveLine(startX, startY, endX, endY) {
            ctx.beginPath();
            ctx.moveTo(startX, startY);
            ctx.lineTo(endX, endY);
            ctx.strokeStyle = '#10B981'; // Green color for active selection
            ctx.lineWidth = 3;
            ctx.stroke();
        }
        
        // Draws all the permanently matched lines (pink/green/red)
        function drawMatchedLines() {
            matchLines.forEach((coords, wordElement) => {
                
                // Re-calculate coordinates for existing matched elements to account for any small layout shifts
                if (quizActive) {
                    const wordPoint = getElementLinePoint(wordElement, true);
                    const definition = matchedPairs.get(wordElement);
                    if (!definition) return;
                    const definitionPoint = getElementLinePoint(definition, false);
                    coords.startX = wordPoint.x;
                    coords.startY = wordPoint.y;
                    coords.endX = definitionPoint.x;
                    coords.endY = definitionPoint.y;
                }
                
                const isCorrect = (wordElement.classList.contains('bg-green-200') && !wordElement.classList.contains('bg-red-200'));
                
                ctx.beginPath();
                ctx.moveTo(coords.startX, coords.startY);
                ctx.lineTo(coords.endX, coords.endY);
                
                if (!quizActive) {
                    ctx.strokeStyle = isCorrect ? '#059669' : '#EF4444';
                    ctx.lineWidth = 3;
                } else {
                    ctx.strokeStyle = '#EC4899'; 
                    ctx.lineWidth = 2;
                }
                ctx.stroke();
            });
        }
        
        // Main function to draw all lines (active and matched)
        function drawLines() {
            clearLine(); 
            if (lineData) {
                drawActiveLine(lineData.startX, lineData.startY, lineData.endX, lineData.endY);
            }
        }
        
        // Handles mouse movement to draw the line to the cursor
        function handleMouseMove(e) {
            if (selectedWord) {
                const containerRect = columnsContainer.getBoundingClientRect();
                const mouseX = e.clientX - containerRect.left;
                const mouseY = e.clientY - containerRect.top;

                const wordPoint = getElementLinePoint(selectedWord, true);
                
                lineData = {
                    startX: wordPoint.x,
                    startY: wordPoint.y,
                    endX: mouseX,
                    endY: mouseY
                };
                drawLines();
            }
        }
        
        columnsContainer.addEventListener('mousemove', handleMouseMove);

        function handleWordClick(e) {
            const word = e.target;
            if (word.classList.contains('bg-pink-300') || !quizActive) {
                clearLine();
                return;
            }

            if (selectedWord && selectedWord !== word) {
                selectedWord.classList.remove('bg-green-400', 'border-green-500');
                selectedWord.classList.add('bg-yellow-200', 'border-yellow-300');
            }
            
            if (selectedWord === word) {
                selectedWord.classList.remove('bg-green-400', 'border-green-500');
                selectedWord.classList.add('bg-yellow-200', 'border-yellow-300');
                selectedWord = null;
                clearLine();
            } else {
                selectedWord = word;
                selectedWord.classList.add('bg-green-400', 'border-green-500');
                selectedWord.classList.remove('bg-yellow-200', 'border-yellow-300');
            }
        }

        function handleWordDoubleClick(e) {
            e.preventDefault();
            const word = e.target;

            if(selectedWord) {
                selectedWord.classList.remove('bg-green-400', 'border-green-500'); 
                selectedWord.classList.add('bg-yellow-200', 'border-yellow-300');
            }
            selectedWord = null;
            clearLine();

            if (word.classList.contains('bg-pink-300') && quizActive) {
                const definition = matchedPairs.get(word);
                if (definition) {
                    definition.classList.remove('bg-pink-300', 'border-pink-400', 'cursor-default');
                    definition.classList.add('bg-blue-200', 'hover:bg-blue-300', 'border-blue-300', 'cursor-pointer');
                    matchedPairs.delete(word);
                    matchLines.delete(word); 
                }
                word.classList.remove('bg-pink-300', 'border-pink-400', 'cursor-default');
                word.classList.add('bg-yellow-200', 'hover:bg-yellow-300', 'border-yellow-300', 'cursor-pointer');
            }
            drawLines();
            checkCompletion();
        }

        function handleDefinitionClick(e) {
            const definition = e.target;
            if (definition.classList.contains('bg-pink-300') || !quizActive) return;

            if (selectedWord) {
                selectedWord.classList.remove('bg-green-400', 'border-green-500', 'bg-yellow-200', 'border-yellow-300');
                
                selectedWord.classList.add('bg-pink-300', 'border-pink-400', 'cursor-default');
                definition.classList.add('bg-pink-300', 'border-pink-400', 'cursor-default');
                
                selectedWord.classList.remove('hover:bg-yellow-300');
                definition.classList.remove('hover:bg-blue-300');
                
                matchedPairs.set(selectedWord, definition);

                // ä¿®æ­£ 3: åœ¨åŒ¹é…æ—¶ä¿å­˜å‡†ç¡®çš„ Canvas ç›¸å¯¹åæ ‡
                const wordPoint = getElementLinePoint(selectedWord, true);
                const definitionPoint = getElementLinePoint(definition, false);
                matchLines.set(selectedWord, {
                    startX: wordPoint.x,
                    startY: wordPoint.y,
                    endX: definitionPoint.x,
                    endY: definitionPoint.y
                });
                
                selectedWord = null;
                clearLine();
            }
            checkCompletion();
        }

        function checkCompletion() {
            const words = document.querySelectorAll('#wordColumn .word');
            const allWordsMatched = Array.from(words).every(word => word.classList.contains('bg-pink-300'));
            const submitButton = document.getElementById('submitButton');

            if (allWordsMatched) {
                submitButton.classList.remove('bg-gray-300', 'text-gray-700', 'cursor-not-allowed');
                submitButton.classList.add('bg-green-500', 'hover:bg-green-600', 'text-white', 'cursor-pointer');
                submitButton.disabled = false;
            } else {
                submitButton.classList.add('bg-gray-300', 'text-gray-700', 'cursor-not-allowed');
                submitButton.classList.remove('bg-green-500', 'hover:bg-green-600', 'text-white');
                submitButton.disabled = true;
            }
        }

        function submitQuiz() {
            if (!quizActive) return;

            const studentName = document.getElementById('studentName').value.trim();
            if (!studentName) {
                showMessage('Missing Information', 'è¯·åœ¨æäº¤æµ‹éªŒå‰è¾“å…¥ä½ çš„åå­— (Please enter your name before submitting the quiz)ã€‚');
                return;
            }

            clearInterval(timerInterval);
            startTime = null;
            quizActive = false;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height); 

            const endTime = new Date();
            const timeDiff = (endTime - startTime) / 1000;
            const minutes = Math.floor(timeDiff / 60);
            const seconds = Math.floor(timeDiff % 60);

            let correctCount = 0;
            let errors = [];
            let totalWordsInQuiz = 0; 

            // Clear old lines and prepare for final state drawing
            matchLines.clear(); 

            document.querySelectorAll('#wordColumn .word').forEach(wordElement => {
                totalWordsInQuiz++;
                
                if (matchedPairs.has(wordElement)) {
                    const matchedDefinitionElement = matchedPairs.get(wordElement);
                    
                    wordElement.classList.remove('bg-pink-300', 'border-pink-400');
                    matchedDefinitionElement.classList.remove('bg-pink-300', 'border-pink-400');


                    if (matchedDefinitionElement.textContent === wordElement.dataset.definition) {
                        correctCount++;
                        wordElement.classList.add('bg-green-200', 'border-green-400');
                        matchedDefinitionElement.classList.add('bg-green-200', 'border-green-400');
                    } else {
                        errors.push(`é”™è¯¯: "${wordElement.textContent}" åŒ¹é…äº† "${matchedDefinitionElement.textContent}" (æ­£ç¡®ç­”æ¡ˆæ˜¯: ${wordElement.dataset.definition})`);
                        wordElement.classList.add('bg-red-200', 'border-red-400');
                        matchedDefinitionElement.classList.add('bg-red-200', 'border-red-400');
                    }
                    
                    // ä¿®æ­£ 4: åœ¨æäº¤æ—¶ï¼Œå†æ¬¡è·å–å¹¶ä¿å­˜æœ€ç»ˆçš„åæ ‡ï¼Œä»¥ç¡®ä¿åœ¨ç»“æœæ˜¾ç¤ºæ—¶çš„è¿çº¿å‡†ç¡®æ€§
                    const wordPoint = getElementLinePoint(wordElement, true);
                    const definitionPoint = getElementLinePoint(matchedDefinitionElement, false);
                    matchLines.set(wordElement, {
                        startX: wordPoint.x,
                        startY: wordPoint.y,
                        endX: definitionPoint.x,
                        endY: definitionPoint.y
                    });
                } else {
                    errors.push(`æœªåŒ¹é…: "${wordElement.textContent}"`);
                    wordElement.classList.remove('bg-pink-300', 'border-pink-400');
                    wordElement.classList.add('bg-yellow-200', 'border-yellow-300');
                }
            });

            drawMatchedLines();


            const accuracy = (correctCount / totalWordsInQuiz) * 100;

            const pageTitle = document.title;
            const submitTime = endTime.toLocaleString();
            
            let resultMessage = `
                é¡µé¢æ ‡é¢˜ (Page Title): ${pageTitle}
                æäº¤æ—¶é—´ (Submission Time): ${submitTime}
                å­¦ç”Ÿå§“å (Student Name): ${studentName}
                å®Œæˆç”¨æ—¶ (Completion Time): ${minutes}åˆ† ${seconds}ç§’
                æ­£ç¡®åŒ¹é… (Correct Matches): ${correctCount}/${totalWordsInQuiz}
                å‡†ç¡®ç‡ (Accuracy): ${accuracy.toFixed(2)}%
            `;

            if (errors.length > 0) {
                resultMessage += `\n\né”™è¯¯è¯¦æƒ… (Errors):\n${errors.join('\n')}`;
            } else {
                resultMessage += `\n\né”™è¯¯ (Errors): None ğŸ‰`;
            }

            showMessage('æµ‹éªŒç»“æœ (Quiz Results)', resultMessage);
        }

        function startTimer() {
            clearInterval(timerInterval);
            remainingTime = totalTime;
            updateTimerDisplay();
            startTime = new Date();
            
            timerInterval = setInterval(() => {
                remainingTime--;
                updateTimerDisplay();

                if (remainingTime <= 0) {
                    clearInterval(timerInterval);
                    showMessage('æ—¶é—´åˆ°! (Time\'s Up!)', 'æ—¶é—´å·²ç”¨å®Œã€‚æµ‹éªŒå·²è‡ªåŠ¨æäº¤ã€‚');
                    setTimeout(submitQuiz, 10); 
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(remainingTime / 60);
            const seconds = remainingTime % 60;
            const timerElement = document.getElementById('timer');
            timerElement.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            
            if (remainingTime <= 30) {
                timerElement.classList.remove('text-blue-600');
                timerElement.classList.add('text-red-600');
            } else {
                timerElement.classList.remove('text-red-600');
                timerElement.classList.add('text-blue-600');
            }
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function showMessage(title, message) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').textContent = message;
            
            const modalContentDiv = document.getElementById('customModal').querySelector('.modal-content');
            
            Array.from(modalContentDiv.querySelectorAll('button')).forEach(button => {
                if (!button.onclick.toString().includes('closeModal()')) {
                     button.remove();
                }
            });
            
            let closeButton = modalContentDiv.querySelector('button[onclick="closeModal()"]');
            if (!closeButton) {
                closeButton = document.createElement('button');
                closeButton.textContent = 'Close';
                closeButton.className = 'px-6 py-3 bg-blue-500 text-white font-semibold rounded-lg shadow-md transition-all duration-300 ease-in-out hover:bg-blue-600 focus:outline-none focus:ring-4 focus:ring-blue-300 text-lg';
                closeButton.onclick = closeModal;
                modalContentDiv.appendChild(closeButton);
            }
            closeButton.style.display = 'inline-block';

            document.getElementById('customModal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('customModal').classList.add('hidden');
        }

        function resetQuiz() {
            const modalMessageDiv = document.getElementById('modalMessage');
            modalMessageDiv.innerHTML = '<p class="text-base text-gray-700 leading-relaxed mb-6 whitespace-pre-line text-left">' + 
                                     'ä½ ç¡®å®šè¦é‡ç½®æµ‹éªŒå—? ä½ å½“å‰çš„è¿›åº¦å°†ä¼šä¸¢å¤±ã€‚' +
                                     '</p>';
            const modalContentDiv = document.getElementById('customModal').querySelector('.modal-content');
            
            Array.from(modalContentDiv.querySelectorAll('button')).forEach(button => button.remove());

            const confirmButton = document.createElement('button');
            confirmButton.textContent = 'ç¡®å®šé‡ç½® (Yes, Reset)';
            confirmButton.className = 'px-6 py-3 bg-red-500 text-white font-semibold rounded-lg shadow-md transition-all duration-300 ease-in-out hover:bg-red-600 focus:outline-none focus:ring-4 focus:ring-red-300 text-lg mr-2';
            confirmButton.onclick = () => {
                clearInterval(timerInterval);
                initQuiz();
                closeModal();
            };

            const cancelButton = document.createElement('button');
            cancelButton.textContent = 'å–æ¶ˆ (Cancel)';
            cancelButton.className = 'px-6 py-3 bg-gray-300 text-gray-700 font-semibold rounded-lg shadow-md transition-all duration-300 ease-in-out hover:bg-gray-400 focus:outline-none focus:ring-4 focus:ring-gray-200 text-lg';
            cancelButton.onclick = closeModal;

            modalContentDiv.appendChild(confirmButton);
            modalContentDiv.appendChild(cancelButton);
            document.getElementById('modalTitle').textContent = 'ç¡®è®¤é‡ç½® (Confirm Reset)';
            document.getElementById('customModal').classList.remove('hidden');
        }

        window.addEventListener('resize', () => {
            resizeCanvas(); 
            clearLine(); 
        });

        window.onload = initQuiz;
    </script>
</body>
</html>
