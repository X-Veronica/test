<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>25-26T1 Week1-NewVocab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles to enhance Tailwind defaults and ensure responsiveness */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f8f8;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        /* Styles for the modal backdrop */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        /* Styles for the modal content */
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            text-align: center;
            max-width: 500px;
            width: 90%;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Custom container for positioning the canvas */
        .quiz-columns-container {
            position: relative; /* Establish positioning context for the canvas */
        }

        /* Canvas for drawing lines */
        #lineCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* Important: Ensures the canvas doesn't block mouse clicks on words/definitions */
            pointer-events: none;
            z-index: 10; 
        }
    </style>
</head>
<body class="selection:bg-blue-200">
    <div id="quiz-main-container" class="bg-white p-6 md:p-10 rounded-xl shadow-lg w-full max-w-4xl space-y-6">
        <div class="text-center space-y-4">
            <h1 id="dateHeading" class="text-3xl md:text-4xl font-extrabold text-gray-800">IELTS Vocabulary Matching Quiz (15 words)</h1>
            <div id="timer" class="text-4xl font-bold text-blue-600">04:00</div>
            <input type="text" id="studentName" placeholder="Enter your name"
                   class="w-full md:w-1/2 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-center text-lg shadow-sm"
                   aria-label="Student Name">
        </div>

        <div class="quiz-columns-container flex flex-col md:flex-row justify-between gap-6">
            
            <canvas id="lineCanvas"></canvas>

            <div class="column flex-1 bg-yellow-50 p-4 rounded-lg shadow-md min-h-[300px] md:min-h-[500px] border border-yellow-200 overflow-auto" id="wordColumn">
                </div>
            <div class="column flex-1 bg-blue-50 p-4 rounded-lg shadow-md min-h-[300px] md:min-h-[500px] border border-blue-200 overflow-auto" id="definitionColumn">
                </div>
        </div>

        <div class="flex flex-col md:flex-row justify-center gap-4 mt-6">
            <button id="submitButton" onclick="submitQuiz()"
                    class="px-8 py-4 bg-gray-300 text-gray-700 font-semibold rounded-lg shadow-md transition-all duration-300 ease-in-out
                           hover:bg-green-600 hover:text-white focus:outline-none focus:ring-4 focus:ring-green-300 text-lg cursor-not-allowed"
                    disabled>
                Submit Quiz
            </button>
            <button id="resetButton" onclick="resetQuiz()"
                    class="px-8 py-4 bg-red-400 text-white font-semibold rounded-lg shadow-md transition-all duration-300 ease-in-out
                           hover:bg-red-600 focus:outline-none focus:ring-4 focus:ring-red-300 text-lg">
                Reset Quiz
            </button>
        </div>
    </div>

    <div id="customModal" class="modal-backdrop hidden">
        <div class="modal-content">
            <h2 id="modalTitle" class="text-2xl font-bold mb-4 text-gray-800"></h2>
            <div id="modalMessage" class="text-base text-gray-700 leading-relaxed mb-6 whitespace-pre-line text-left"></div>
            <button onclick="closeModal()"
                    class="px-6 py-3 bg-blue-500 text-white font-semibold rounded-lg shadow-md transition-all duration-300 ease-in-out
                           hover:bg-blue-600 focus:outline-none focus:ring-4 focus:ring-blue-300 text-lg">
                Close
            </button>
        </div>
    </div>

    <script>
        // --- Áî®Êà∑ÁöÑÊõ¥Êñ∞ËØçÊ±áÊï∞ÊçÆ ---
        const vocabulary = [
            { word: "conceal", definition: "ÈöêËóè" },
            { word: "claim", definition: "Â£∞Áß∞" },
            { word: "tone", definition: "ËØ≠Ê∞î" },
            { word: "range", definition: "ËåÉÂõ¥" },
            { word: "import", definition: "ËøõÂè£" },
            { word: "pledge", definition: "‰øùËØÅ" },
            { word: "thrive", definition: "ÁπÅËç£" },
            { word: "starve", definition: "Êå®È•ø" },
            { word: "imply", definition: "ÊöóÁ§∫" },
            { word: "density", definition: "ÂØÜÂ∫¶" },
            { word: "strain", definition: "ÂéãÂäõ" },
            { word: "leap", definition: "Ë∑≥Ë∑É" },
            { word: "scold", definition: "Ë¥£È™Ç" },
            { word: "perceive", definition: "ÂØüËßâ" },
            { word: "stimulate", definition: "Âà∫ÊøÄ" },
            { word: "digest", definition: "Ê∂àÂåñ" },
            { word: "prior", definition: "ÂÖàÂâçÁöÑ" },
            { word: "urge", definition: "ÂÇ¨‰øÉ" },
            { word: "obligation", definition: "‰πâÂä°" },
            { word: "panic", definition: "ÊÅêÊÖå" },
            { word: "spare", definition: "È•∂ÊÅï" },
            { word: "crucial", definition: "Ëá≥ÂÖ≥ÈáçË¶ÅÁöÑ" },
            { word: "digital", definition: "Êï∞Â≠óÁöÑ" },
            { word: "glance", definition: "Áû•‰∏ÄÁúº" },
            { word: "resume", definition: "ÊÅ¢Â§ç" },
            { word: "retreat", definition: "Êí§ÈÄÄ" },
            { word: "fade", definition: "Ë§™Ëâ≤" },
            { word: "tender", definition: "Ê∏©ÊüîÁöÑ" },
            { word: "harmony", definition: "ÂíåË∞ê" },
            { word: "appeal", definition: "ÂëºÂêÅ" },
            { word: "manual", definition: "ÊâãÂ∑•ÁöÑ" },
            { word: "appetite", definition: "È£üÊ¨≤" },
            { word: "convert", definition: "ËΩ¨Êç¢" },
            { word: "pump", definition: "ÊäΩÊ∞¥" },
            { word: "counsel", definition: "Âª∫ËÆÆ" },
            { word: "renovate", definition: "ÁøªÊñ∞" },
            { word: "liberal", definition: "Ëá™Áî±ÁöÑ" },
            { word: "remote", definition: "ÈÅ•ËøúÁöÑ" },
            { word: "facility", definition: "ËÆæÊñΩ" },
            { word: "peculiar", definition: "Â•áÊÄ™ÁöÑ" },
            { word: "stem", definition: "Ê∫ê‰∫é" },
            { word: "margin", definition: "ËæπÁºò" },
            { word: "block", definition: "ÈòªÁ¢ç" },
            { word: "infect", definition: "ÊÑüÊüì" },
            { word: "illusion", definition: "ÂπªËßâ" },
            { word: "fierce", definition: "Âá∂ÁåõÁöÑ" },
            { word: "strip", definition: "Ââ•Âéª" },
            { word: "fuss", definition: "Â§ßÊÉäÂ∞èÊÄ™" },
            { word: "tremendous", definition: "Â∑®Â§ßÁöÑ" },
            { word: "exploit", definition: "Âà©Áî®" },
            { word: "recession", definition: "Ë°∞ÈÄÄ" },
            { word: "hinder", definition: "ÈòªÁ¢ç" },
            { word: "context", definition: "ËÉåÊôØ" },
            { word: "prospect", definition: "ÂâçÊôØ" },
            { word: "inevitable", definition: "‰∏çÂèØÈÅøÂÖçÁöÑ" },
            { word: "discrimination", definition: "Ê≠ßËßÜ" },
            { word: "optimism", definition: "‰πêËßÇ" },
            { word: "postpone", definition: "Êé®Ëøü" },
            { word: "incentive", definition: "ÊøÄÂä±" },
            { word: "victim", definition: "ÂèóÂÆ≥ËÄÖ" },
            { word: "inspire", definition: "ÈºìËàû" },
            { word: "virtual", definition: "ËôöÊãüÁöÑ" },
            { word: "dare", definition: "Êï¢‰∫é" },
            { word: "in that", definition: "Âõ†‰∏∫" },
            { word: "vague", definition: "Ê®°Á≥äÁöÑ" },
            { word: "capacity", definition: "ËÉΩÂäõ" },
            { word: "discard", definition: "‰∏¢ÂºÉ" },
            { word: "incident", definition: "‰∫ã‰ª∂" },
            { word: "instinct", definition: "Êú¨ËÉΩ" },
            { word: "rank", definition: "Á≠âÁ∫ß" },
            { word: "emerge", definition: "Âá∫Áé∞" },
            { word: "coordinate", definition: "ÂçèË∞É" },
            { word: "temporary", definition: "‰∏¥Êó∂ÁöÑ" },
            { word: "aviation", definition: "Ëà™Á©∫" },
            { word: "detect", definition: "‰æ¶Êµã" },
            { word: "slim", definition: "ËãóÊù°ÁöÑ" },
            { word: "retain", definition: "‰øùÁïô" },
            { word: "latter", definition: "ÂêéËÄÖÁöÑ" },
            { word: "poverty", definition: "Ë¥´Á©∑" },
            { word: "bargain", definition: "‰∫§Êòì" },
            { word: "orbit", definition: "ËΩ®ÈÅì" },
            { word: "dismiss", definition: "Ëß£Èõá" },
            { word: "constitute", definition: "ÊûÑÊàê" },
            { word: "reverse", definition: "È¢†ÂÄí" },
            { word: "evolve", definition: "ËøõÂåñ" },
            { word: "fatigue", definition: "Áñ≤Âä≥" },
            { word: "dispose", definition: "Â§ÑÁêÜ" },
            { word: "confront", definition: "Èù¢ÂØπ" },
            { word: "dilemma", definition: "Âõ∞Â¢É" },
            { word: "abundant", definition: "‰∏∞ÂØåÁöÑ" },
            { word: "wander", definition: "Êº´Ê≠•" }
        ];
        // --- ËØçÊ±áÊï∞ÊçÆÁªìÊùü ---

        // ËÆæÁΩÆ‰ªéËØçÊ±áÂ∫ì‰∏≠ÊäΩÂèñÁöÑËØçÊ±áÊï∞Èáè
        const QUIZ_WORD_COUNT = 15; 

        let selectedWord = null;
        let matchedPairs = new Map();
        let startTime;
        let timerInterval;
        const totalTime = 240; // 4 minutes
        let remainingTime = totalTime;
        let quizActive = false;

        // --- Line Drawing Variables and Setup ---
        const canvas = document.getElementById('lineCanvas');
        const ctx = canvas.getContext('2d');
        const columnsContainer = document.querySelector('.quiz-columns-container');
        
        let lineData = null; 
        const matchLines = new Map(); 

        // Function to initialize or reset the quiz
        function initQuiz() {
            // Clear existing elements
            document.getElementById('wordColumn').innerHTML = '';
            document.getElementById('definitionColumn').innerHTML = '';
            matchedPairs.clear();
            selectedWord = null;
            document.getElementById('submitButton').classList.remove('bg-green-500', 'hover:bg-green-600', 'text-white');
            document.getElementById('submitButton').classList.add('bg-gray-300', 'text-gray-700');
            document.getElementById('submitButton').disabled = true;
            document.getElementById('studentName').value = '';
            
            // Clear all line data and redraw the canvas
            matchLines.clear();
            clearLine(); 
            if (selectedWord) {
                selectedWord.classList.remove('bg-green-400', 'border-green-500'); 
                selectedWord.classList.add('bg-yellow-200', 'border-yellow-300');
            }


            // Set heading
            document.getElementById('dateHeading').textContent = 'IELTS Vocabulary Matching Quiz (' + QUIZ_WORD_COUNT + ' words)';

            // Randomly select words and their definitions
            const selectedWordsData = shuffleArray(vocabulary).slice(0, QUIZ_WORD_COUNT);
            const correctDefinitionsData = selectedWordsData.map(item => item.definition);

            // No distractor definitions used (as per your initial setup)
            const allDefinitions = shuffleArray(correctDefinitionsData);

            // Display words in the word column
            selectedWordsData.forEach(item => {
                const div = document.createElement('div');
                div.className = 'word p-3 mb-2 rounded-lg cursor-pointer transition-all duration-200 ease-in-out ' +
                                 'bg-yellow-200 hover:bg-yellow-300 shadow-sm border border-yellow-300';
                div.textContent = item.word;
                div.dataset.definition = item.definition; // Store correct definition for checking
                div.addEventListener('click', handleWordClick);
                div.addEventListener('dblclick', handleWordDoubleClick);
                document.getElementById('wordColumn').appendChild(div);
            });

            // Display definitions in the definition column
            allDefinitions.forEach(definition => {
                const div = document.createElement('div');
                div.className = 'definition p-3 mb-2 rounded-lg cursor-pointer transition-all duration-200 ease-in-out ' +
                                 'bg-blue-200 hover:bg-blue-300 shadow-sm border border-blue-300';
                div.textContent = definition;
                div.addEventListener('click', handleDefinitionClick);
                document.getElementById('definitionColumn').appendChild(div);
            });

            // Set up canvas size and start the timer
            resizeCanvas();
            startTimer();
            quizActive = true;
        }

        // Resizes the canvas to match the columns container dimensions
        function resizeCanvas() {
            const rect = columnsContainer.getBoundingClientRect();
            // Set canvas size to match the container's *client* size
            canvas.width = columnsContainer.clientWidth; 
            canvas.height = columnsContainer.clientHeight;
        }

        // Helper function to get the center-right or center-left coordinates of an element
        function getElementLinePoint(element, isWord) {
            const rect = element.getBoundingClientRect();
            const containerRect = columnsContainer.getBoundingClientRect();
            // Word Column (isWord=true): use right edge, Definition Column (isWord=false): use left edge
            const x = isWord ? rect.right - containerRect.left : rect.left - containerRect.left;
            const y = rect.top + rect.height / 2 - containerRect.top;
            return { x, y };
        }

        // Clears the canvas entirely and resets lineData
        function clearLine() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            lineData = null; // Clear active line data
            drawMatchedLines(); // Redraw permanent lines
        }

        // Draws a single active line (from a selected word)
        function drawActiveLine(startX, startY, endX, endY) {
            ctx.beginPath();
            ctx.moveTo(startX, startY);
            ctx.lineTo(endX, endY);
            ctx.strokeStyle = '#10B981'; // Green color for active selection
            ctx.lineWidth = 3;
            ctx.stroke();
        }
        
        // Draws all the permanently matched lines (pink)
        function drawMatchedLines() {
            matchLines.forEach((coords, wordElement) => {
                // Determine color based on final state for submission only
                const isCorrect = (wordElement.classList.contains('bg-green-200') && !wordElement.classList.contains('bg-red-200'));
                const isIncorrect = wordElement.classList.contains('bg-red-200');

                ctx.beginPath();
                ctx.moveTo(coords.startX, coords.startY);
                ctx.lineTo(coords.endX, coords.endY);
                
                if (!quizActive) { // If quiz is submitted, use final colors
                    ctx.strokeStyle = isCorrect ? '#059669' : '#EF4444'; // Dark green/red for result
                    ctx.lineWidth = 3;
                } else { // During quiz, use pink
                    ctx.strokeStyle = '#EC4899'; 
                    ctx.lineWidth = 2;
                }
                ctx.stroke();
            });
        }
        
        // Main function to draw all lines (active and matched)
        function drawLines() {
            clearLine(); // Clears all, redraws matched
            if (lineData) {
                drawActiveLine(lineData.startX, lineData.startY, lineData.endX, lineData.endY);
            }
        }
        
        // Handles mouse movement to draw the line to the cursor
        function handleMouseMove(e) {
            if (selectedWord) {
                const containerRect = columnsContainer.getBoundingClientRect();
                const mouseX = e.clientX - containerRect.left;
                const mouseY = e.clientY - containerRect.top;

                const wordPoint = getElementLinePoint(selectedWord, true);
                
                lineData = {
                    startX: wordPoint.x,
                    startY: wordPoint.y,
                    endX: mouseX,
                    endY: mouseY
                };
                drawLines();
            }
        }
        
        // Attach the mouse move listener to the columns container
        columnsContainer.addEventListener('mousemove', handleMouseMove);

        // Handles click on a word element
        function handleWordClick(e) {
            const word = e.target;
            if (word.classList.contains('bg-pink-300') || !quizActive) {
                clearLine();
                return;
            }

            if (selectedWord && selectedWord !== word) {
                selectedWord.classList.remove('bg-green-400', 'border-green-500');
                selectedWord.classList.add('bg-yellow-200', 'border-yellow-300');
            }
            
            // Toggle selection
            if (selectedWord === word) {
                selectedWord.classList.remove('bg-green-400', 'border-green-500');
                selectedWord.classList.add('bg-yellow-200', 'border-yellow-300');
                selectedWord = null;
                clearLine();
            } else {
                selectedWord = word;
                selectedWord.classList.add('bg-green-400', 'border-green-500');
                selectedWord.classList.remove('bg-yellow-200', 'border-yellow-300');
                // Mousemove will draw the line
            }
        }

        // Handles double-click on a word element (for unmatching)
        function handleWordDoubleClick(e) {
            e.preventDefault();
            const word = e.target;

            // Clear any active line/selection
            if(selectedWord) {
                selectedWord.classList.remove('bg-green-400', 'border-green-500'); 
                selectedWord.classList.add('bg-yellow-200', 'border-yellow-300');
            }
            selectedWord = null;
            clearLine();

            // If the word is currently matched, unmatch it
            if (word.classList.contains('bg-pink-300') && quizActive) {
                const definition = matchedPairs.get(word);
                if (definition) {
                    definition.classList.remove('bg-pink-300', 'border-pink-400', 'cursor-default');
                    definition.classList.add('bg-blue-200', 'hover:bg-blue-300', 'border-blue-300', 'cursor-pointer');
                    matchedPairs.delete(word);
                    matchLines.delete(word); // Remove line data
                }
                word.classList.remove('bg-pink-300', 'border-pink-400', 'cursor-default');
                word.classList.add('bg-yellow-200', 'hover:bg-yellow-300', 'border-yellow-300', 'cursor-pointer');
            }
            drawLines();
            checkCompletion();
        }

        // Handles click on a definition element
        function handleDefinitionClick(e) {
            const definition = e.target;
            if (definition.classList.contains('bg-pink-300') || !quizActive) return;

            // Match if a word is selected
            if (selectedWord) {
                // 1. Remove 'selected' class from the word
                selectedWord.classList.remove('bg-green-400', 'border-green-500', 'bg-yellow-200', 'border-yellow-300');
                
                // 2. Apply 'matched' styling
                selectedWord.classList.add('bg-pink-300', 'border-pink-400', 'cursor-default');
                definition.classList.add('bg-pink-300', 'border-pink-400', 'cursor-default');
                
                // 3. Remove hover effects for matched items
                selectedWord.classList.remove('hover:bg-yellow-300');
                definition.classList.remove('hover:bg-blue-300');
                
                // 4. Store the matched pair
                matchedPairs.set(selectedWord, definition);

                // 5. Store the line coordinates for the matched pair
                const wordPoint = getElementLinePoint(selectedWord, true);
                const definitionPoint = getElementLinePoint(definition, false);
                matchLines.set(selectedWord, {
                    startX: wordPoint.x,
                    startY: wordPoint.y,
                    endX: definitionPoint.x,
                    endY: definitionPoint.y
                });
                
                selectedWord = null; // Clear selected word
                clearLine(); // Clear active line and redraw matched lines
            }
            checkCompletion();
        }

        // Checks if all words have been matched and updates submit button state
        function checkCompletion() {
            const words = document.querySelectorAll('#wordColumn .word');
            const allWordsMatched = Array.from(words).every(word => word.classList.contains('bg-pink-300'));
            const submitButton = document.getElementById('submitButton');

            if (allWordsMatched) {
                submitButton.classList.remove('bg-gray-300', 'text-gray-700', 'cursor-not-allowed');
                submitButton.classList.add('bg-green-500', 'hover:bg-green-600', 'text-white', 'cursor-pointer');
                submitButton.disabled = false;
            } else {
                submitButton.classList.add('bg-gray-300', 'text-gray-700', 'cursor-not-allowed');
                submitButton.classList.remove('bg-green-500', 'hover:bg-green-600', 'text-white');
                submitButton.disabled = true;
            }
        }

        // Handles quiz submission
        function submitQuiz() {
            if (!quizActive) return;

            const studentName = document.getElementById('studentName').value.trim();
            if (!studentName) {
                showMessage('Missing Information', 'ËØ∑Âú®Êèê‰∫§ÊµãÈ™åÂâçËæìÂÖ•‰Ω†ÁöÑÂêçÂ≠ó (Please enter your name before submitting the quiz)„ÄÇ');
                return;
            }

            // Stop the timer
            clearInterval(timerInterval);
            startTime = null;
            quizActive = false;
            
            // Clear the canvas completely before final result drawing
            ctx.clearRect(0, 0, canvas.width, canvas.height); 

            const endTime = new Date();
            const timeDiff = (endTime - startTime) / 1000;
            const minutes = Math.floor(timeDiff / 60);
            const seconds = Math.floor(timeDiff % 60);

            let correctCount = 0;
            let errors = [];
            let totalWordsInQuiz = 0; 

            document.querySelectorAll('#wordColumn .word').forEach(wordElement => {
                totalWordsInQuiz++;
                
                if (matchedPairs.has(wordElement)) {
                    const matchedDefinitionElement = matchedPairs.get(wordElement);
                    
                    // Remove all temporary colors
                    wordElement.classList.remove('bg-pink-300', 'border-pink-400');
                    matchedDefinitionElement.classList.remove('bg-pink-300', 'border-pink-400');


                    if (matchedDefinitionElement.textContent === wordElement.dataset.definition) {
                        correctCount++;
                        // Highlight correct matches in a final green color
                        wordElement.classList.add('bg-green-200', 'border-green-400');
                        matchedDefinitionElement.classList.add('bg-green-200', 'border-green-400');
                    } else {
                        errors.push(`ÈîôËØØ: "${wordElement.textContent}" ÂåπÈÖç‰∫Ü "${matchedDefinitionElement.textContent}" (Ê≠£Á°ÆÁ≠îÊ°àÊòØ: ${wordElement.dataset.definition})`);
                        // Highlight incorrect matches in a final red color
                        wordElement.classList.add('bg-red-200', 'border-red-400');
                        matchedDefinitionElement.classList.add('bg-red-200', 'border-red-400');
                    }
                } else {
                    errors.push(`Êú™ÂåπÈÖç: "${wordElement.textContent}"`);
                    // Unmatched words stay yellow/default
                    wordElement.classList.remove('bg-pink-300', 'border-pink-400');
                    wordElement.classList.add('bg-yellow-200', 'border-yellow-300');
                }
            });

            // Redraw the lines with the final color coding
            drawMatchedLines();


            const accuracy = (correctCount / totalWordsInQuiz) * 100;

            const pageTitle = document.title;
            const submitTime = endTime.toLocaleString();
            
            // Construct the result message for the modal
            let resultMessage = `
                È°µÈù¢Ê†áÈ¢ò (Page Title): ${pageTitle}
                Êèê‰∫§Êó∂Èó¥ (Submission Time): ${submitTime}
                Â≠¶ÁîüÂßìÂêç (Student Name): ${studentName}
                ÂÆåÊàêÁî®Êó∂ (Completion Time): ${minutes}ÂàÜ ${seconds}Áßí
                Ê≠£Á°ÆÂåπÈÖç (Correct Matches): ${correctCount}/${totalWordsInQuiz}
                ÂáÜÁ°ÆÁéá (Accuracy): ${accuracy.toFixed(2)}%
            `;

            if (errors.length > 0) {
                resultMessage += `\n\nÈîôËØØËØ¶ÊÉÖ (Errors):\n${errors.join('\n')}`;
            } else {
                resultMessage += `\n\nÈîôËØØ (Errors): None üéâ`;
            }

            showMessage('ÊµãÈ™åÁªìÊûú (Quiz Results)', resultMessage);
        }

        // Starts the countdown timer
        function startTimer() {
            clearInterval(timerInterval);
            remainingTime = totalTime;
            updateTimerDisplay();
            startTime = new Date();
            
            timerInterval = setInterval(() => {
                remainingTime--;
                updateTimerDisplay();

                if (remainingTime <= 0) {
                    clearInterval(timerInterval);
                    showMessage('Êó∂Èó¥Âà∞! (Time\'s Up!)', 'Êó∂Èó¥Â∑≤Áî®ÂÆå„ÄÇÊµãÈ™åÂ∑≤Ëá™Âä®Êèê‰∫§„ÄÇ');
                    setTimeout(submitQuiz, 10); 
                }
            }, 1000);
        }

        // Updates the timer display
        function updateTimerDisplay() {
            const minutes = Math.floor(remainingTime / 60);
            const seconds = remainingTime % 60;
            const timerElement = document.getElementById('timer');
            timerElement.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            
            // Change color when time is low
            if (remainingTime <= 30) {
                timerElement.classList.remove('text-blue-600');
                timerElement.classList.add('text-red-600');
            } else {
                timerElement.classList.remove('text-red-600');
                timerElement.classList.add('text-blue-600');
            }
        }

        // Shuffles an array (Fisher-Yates algorithm)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]]; // Swap elements
            }
            return array;
        }

        // Displays a custom modal message
        function showMessage(title, message) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').textContent = message;
            
            const modalContentDiv = document.getElementById('customModal').querySelector('.modal-content');
            
            Array.from(modalContentDiv.querySelectorAll('button')).forEach(button => {
                if (!button.onclick.toString().includes('closeModal()')) {
                     button.remove();
                }
            });
            
            let closeButton = modalContentDiv.querySelector('button[onclick="closeModal()"]');
            if (!closeButton) {
                closeButton = document.createElement('button');
                closeButton.textContent = 'Close';
                closeButton.className = 'px-6 py-3 bg-blue-500 text-white font-semibold rounded-lg shadow-md transition-all duration-300 ease-in-out hover:bg-blue-600 focus:outline-none focus:ring-4 focus:ring-blue-300 text-lg';
                closeButton.onclick = closeModal;
                modalContentDiv.appendChild(closeButton);
            }
            closeButton.style.display = 'inline-block';

            document.getElementById('customModal').classList.remove('hidden');
        }

        // Closes the custom modal message
        function closeModal() {
            document.getElementById('customModal').classList.add('hidden');
        }

        // Resets the quiz to its initial state
        function resetQuiz() {
            const modalMessageDiv = document.getElementById('modalMessage');
            modalMessageDiv.innerHTML = '<p class="text-base text-gray-700 leading-relaxed mb-6 whitespace-pre-line text-left">' + 
                                     '‰Ω†Á°ÆÂÆöË¶ÅÈáçÁΩÆÊµãÈ™åÂêó? ‰Ω†ÂΩìÂâçÁöÑËøõÂ∫¶Â∞Ü‰ºö‰∏¢Â§±„ÄÇ' +
                                     '</p>';
            const modalContentDiv = document.getElementById('customModal').querySelector('.modal-content');
            
            Array.from(modalContentDiv.querySelectorAll('button')).forEach(button => button.remove());

            const confirmButton = document.createElement('button');
            confirmButton.textContent = 'Á°ÆÂÆöÈáçÁΩÆ (Yes, Reset)';
            confirmButton.className = 'px-6 py-3 bg-red-500 text-white font-semibold rounded-lg shadow-md transition-all duration-300 ease-in-out hover:bg-red-600 focus:outline-none focus:ring-4 focus:ring-red-300 text-lg mr-2';
            confirmButton.onclick = () => {
                clearInterval(timerInterval);
                initQuiz();
                closeModal();
            };

            const cancelButton = document.createElement('button');
            cancelButton.textContent = 'ÂèñÊ∂à (Cancel)';
            cancelButton.className = 'px-6 py-3 bg-gray-300 text-gray-700 font-semibold rounded-lg shadow-md transition-all duration-300 ease-in-out hover:bg-gray-400 focus:outline-none focus:ring-4 focus:ring-gray-200 text-lg';
            cancelButton.onclick = closeModal;

            modalContentDiv.appendChild(confirmButton);
            modalContentDiv.appendChild(cancelButton);
            document.getElementById('modalTitle').textContent = 'Á°ÆËÆ§ÈáçÁΩÆ (Confirm Reset)';
            document.getElementById('customModal').classList.remove('hidden');
        }

        // Add event listener for window resize to keep the canvas aligned
        window.addEventListener('resize', () => {
            resizeCanvas(); 
            clearLine(); 
        });

        // Initialize quiz when the window loads
        window.onload = initQuiz;
    </script>
</body>
</html>
