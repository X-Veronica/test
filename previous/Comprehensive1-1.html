<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive1-1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles to enhance Tailwind defaults and ensure responsiveness */
        body {
            font-family: 'Inter', sans-serif; /* Using Inter font */
            background-color: #f8f8f8; /* Light background */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        /* Styles for the modal backdrop */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6); /* Semi-transparent dark overlay */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000; /* Ensure it's on top */
            backdrop-filter: blur(5px); /* Add a blur effect */
        }

        /* Styles for the modal content */
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 15px; /* Rounded corners for the modal */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2); /* Soft shadow */
            text-align: center;
            max-width: 500px;
            width: 90%;
            animation: fadeIn 0.3s ease-out; /* Simple fade-in animation */
        }

        /* Fade-in animation for modal */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="selection:bg-blue-200">
    <div class="bg-white p-6 md:p-10 rounded-xl shadow-lg w-full max-w-4xl space-y-6">
        <div class="text-center space-y-4">
            <h1 id="dateHeading" class="text-3xl md:text-4xl font-extrabold text-gray-800"></h1>
            <div id="timer" class="text-4xl font-bold text-blue-600">04:00</div>
            <input type="text" id="studentName" placeholder="Enter your name"
                   class="w-full md:w-1/2 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-center text-lg shadow-sm"
                   aria-label="Student Name">
        </div>

        <div class="flex flex-col md:flex-row justify-between gap-6">
            <div class="column flex-1 bg-yellow-50 p-4 rounded-lg shadow-md min-h-[300px] md:min-h-[500px] border border-yellow-200 overflow-auto" id="wordColumn">
            </div>
            <div class="column flex-1 bg-blue-50 p-4 rounded-lg shadow-md min-h-[300px] md:min-h-[500px] border border-blue-200 overflow-auto" id="definitionColumn">
            </div>
        </div>

        <div class="flex flex-col md:flex-row justify-center gap-4 mt-6">
            <button id="submitButton" onclick="submitQuiz()"
                    class="px-8 py-4 bg-gray-300 text-gray-700 font-semibold rounded-lg shadow-md transition-all duration-300 ease-in-out
                           hover:bg-green-600 hover:text-white focus:outline-none focus:ring-4 focus:ring-green-300 text-lg cursor-not-allowed"
                    disabled>
                Submit Quiz
            </button>
            <button id="resetButton" onclick="resetQuiz()"
                    class="px-8 py-4 bg-red-400 text-white font-semibold rounded-lg shadow-md transition-all duration-300 ease-in-out
                           hover:bg-red-600 focus:outline-none focus:ring-4 focus:ring-red-300 text-lg">
                Reset Quiz
            </button>
        </div>
    </div>

    <div id="customModal" class="modal-backdrop hidden">
        <div class="modal-content">
            <h2 id="modalTitle" class="text-2xl font-bold mb-4 text-gray-800"></h2>
            <div id="modalMessage" class="text-base text-gray-700 leading-relaxed mb-6 text-left"></div> 
            <button onclick="closeModal()"
                    class="px-6 py-3 bg-blue-500 text-white font-semibold rounded-lg shadow-md transition-all duration-300 ease-in-out
                           hover:bg-blue-600 focus:outline-none focus:ring-4 focus:ring-blue-300 text-lg">
                Close
            </button>
        </div>
    </div>

    <script>
    // Vocabulary data for the quiz
    const vocabulary = [
         { word: "cooperation", definition: "Âêà‰ΩúÔºõÂçè‰Ωú" },
    { word: "pace", definition: "Ê≠•‰ºêÔºõÈÄüÂ∫¶" },
    { word: "formal", definition: "Ê≠£ÂºèÁöÑÔºõÊãòÊ≥•‰∫éÂΩ¢ÂºèÁöÑ" },
    { word: "shallow", definition: "ÊµÖÁöÑÔºõËÇ§ÊµÖÁöÑ" },
    { word: "fiction", definition: "Â∞èËØ¥ÔºõËôöÊûÑ" },
    { word: "explode", definition: "ÁàÜÁÇ∏ÔºõÊøÄÂ¢û" },
    { word: "fate", definition: "ÂëΩËøê" },
    { word: "term", definition: "ÊúØËØ≠ÔºõÂ≠¶ÊúüÔºõÊù°Ê¨æ" },
    { word: "tough", definition: "ÂùöÈüßÁöÑÔºõÂõ∞ÈöæÁöÑ" },
    { word: "satisfy", definition: "‰ΩøÊª°ÊÑèÔºõÊª°Ë∂≥" },
    { word: "liberty", definition: "Ëá™Áî±" },
    { word: "cure", definition: "Ê≤ªÊÑàÔºõÊ∂àÈô§" },
    { word: "target", definition: "ÁõÆÊ†áÔºõÈù∂Â≠ê" },
    { word: "equal", definition: "Âπ≥Á≠âÁöÑÔºõÁõ∏Á≠âÁöÑ" },
    { word: "dramatic", definition: "ÊàèÂâßÊÄßÁöÑÔºõÂ∑®Â§ßÁöÑ" },
    { word: "giant", definition: "Â∑®Â§ßÁöÑ" },
    { word: "cell", definition: "ÁªÜËÉûÔºõÂ∞èÈöîÈó¥" },
    { word: "urban", definition: "ÂüéÂ∏ÇÁöÑÔºõÈÉΩÂ∏ÇÁöÑ" },
    { word: "inspire", definition: "ÈºìËàûÔºõÊøÄÂä±" },
    { word: "pursue", definition: "ËøΩËµ∂ÔºõËøΩÊ±Ç" },
    { word: "brilliant", definition: "Êù∞Âá∫ÁöÑÔºõËÅ™ÊòéÁöÑ" },
    { word: "comment", definition: "ËØÑËÆ∫ÔºõÊÑèËßÅ" },
    { word: "delight", definition: "È´òÂÖ¥ÔºõÊÑâÂø´" },
    { word: "donate", definition: "ÊçêËµ†ÔºõÊçêÁåÆ" },
    { word: "mature", definition: "ÊàêÁÜüÁöÑ" },
    { word: "chain", definition: "ÈìæÊù°ÔºõËøûÈîÅÔºàÂ∫óÔºâ" },
    { word: "order", definition: "È°∫Â∫èÔºõÂëΩ‰ª§ÔºõÁß©Â∫è" },
    { word: "arouse", definition: "Âî§Ëµ∑ÔºõÂºïËµ∑" },
    { word: "principle", definition: "ÂéüÂàôÔºõÂéüÁêÜ" },
    { word: "ensure", definition: "Á°Æ‰øùÔºõ‰øùËØÅ" },
    { word: "recommend", definition: "Êé®ËçêÔºõÂª∫ËÆÆ" },
    { word: "deserve", definition: "Â∫îÂæóÔºõÂÄºÂæó" },
    { word: "ceremony", definition: "ÂÖ∏Á§ºÔºõ‰ª™Âºè" },
    { word: "native", definition: "Êú¨ÂõΩÁöÑÔºõÊú¨ÂúüÁöÑ" },
    { word: "interrupt", definition: "ÊâìÊñ≠Ôºõ‰∏≠Êñ≠" },
    { word: "put up with", definition: "ÂøçÂèóÔºõÂÆπÂøç" },
    { word: "litter", definition: "‰π±ÊâîÂûÉÂúæ" },
    { word: "cancel", definition: "ÂèñÊ∂à" },
    { word: "persuade", definition: "ËØ¥ÊúçÔºõÂäùËØ¥" },
    { word: "royal", definition: "ÁöáÂÆ∂ÁöÑÔºõÁéãÂÆ§ÁöÑ" },
    { word: "fame", definition: "ÂêçÂ£∞ÔºõÂêçÊúõ" },
    { word: "possess", definition: "Êã•ÊúâÔºõÂç†Êúâ" },
    { word: "decline", definition: "‰∏ãÈôçÔºõÊãíÁªù" },
    { word: "pretend", definition: "ÂÅáË£Ö" },
    { word: "dynasty", definition: "ÁéãÊúùÔºõÊúù‰ª£" },
    { word: "evident", definition: "ÊòéÊòæÁöÑÔºõÊòéÁôΩÁöÑ" },
    { word: "discipline", definition: "Á∫™ÂæãÔºõÂ≠¶Áßë" },
    { word: "expose", definition: "Êö¥Èú≤ÔºõÊè≠Èú≤" },
    { word: "symptom", definition: "ÁóáÁä∂ÔºõÂæÅÂÖÜ" },
    { word: "bring about", definition: "ÂØºËá¥ÔºõÂºïËµ∑" },
    { word: "psychology", definition: "ÂøÉÁêÜÂ≠¶ÔºõÂøÉÁêÜ" },
    { word: "undertake", definition: "ÊâøÊãÖÔºõÁùÄÊâãÂÅö" },
    { word: "cautious", definition: "Ë∞®ÊÖéÁöÑÔºõÂ∞èÂøÉÁöÑ" },
    { word: "indicate", definition: "Ë°®ÊòéÔºõÊåáÁ§∫" },
    { word: "seek", definition: "ÂØªÊâæÔºõÊé¢Á¥¢" },
    { word: "establish", definition: "Âª∫Á´ãÔºõÁ°ÆÁ´ã" },
    { word: "fantasy", definition: "ÂπªÊÉ≥ÔºõÊÉ≥Ë±°" },
    { word: "declare", definition: "ÂÆ£Â∏ÉÔºõÂ£∞Êòé" },
    { word: "prohibit", definition: "Á¶ÅÊ≠¢" },
    { word: "innocent", definition: "Êó†ËæúÁöÑÔºõÂ§©ÁúüÁöÑ" },
    { word: "steady", definition: "Á®≥ÂÆöÁöÑÔºõÊåÅÁª≠ÁöÑ" },
    { word: "former", definition: "‰ª•ÂâçÁöÑÔºõÂâç‰ªªÁöÑ" },
    { word: "device", definition: "Ë£ÖÁΩÆÔºõËÆæÂ§á" },
    { word: "progress", definition: "ËøõÊ≠•ÔºõËøõÂ±ï" },
    { word: "ashamed", definition: "ÊÉ≠ÊÑßÁöÑÔºõÁæûËÄªÁöÑ" },
    { word: "theory", definition: "ÁêÜËÆ∫ÔºõÂ≠¶ËØ¥" },
    { word: "respectful", definition: "ÊÅ≠Êï¨ÁöÑÔºõÂ∞äÊï¨‰∫∫ÁöÑ" },
    { word: "bacteria", definition: "ÁªÜËèå" },
    { word: "cruel", definition: "ÊÆãÂøçÁöÑÔºõÊÆãÈÖ∑ÁöÑ" },
    { word: "leisure", definition: "Èó≤ÊöáÔºõÁ©∫Èó≤" },
    { word: "encounter", definition: "ÂÅ∂ÁÑ∂ÈÅáÂà∞ÔºõÈÅ≠ÈÅá" },
    { word: "hook", definition: "Èí©Â≠êÔºõÈô∑Èò±" },
    { word: "status", definition: "Âú∞‰ΩçÔºõË∫´‰ªΩ" },
    { word: "boundary", definition: "ÁïåÈôêÔºõËæπÁïå" },
    { word: "superior", definition: "‰ºòË∂äÁöÑÔºõ‰∏äÁ∫ßÁöÑ" },
    { word: "stream", definition: "Ê∫™ÊµÅÔºõ‰∏ÄËÇ°" },
    { word: "shelter", definition: "Â∫áÊä§ÊâÄÔºõ‰ΩèÊâÄ" },
    { word: "assist", definition: "ÂçèÂä©ÔºõÂ∏ÆÂä©" },
    { word: "favour", definition: "ÂñúÁà±ÔºõÊÅ©ÊÉ†" },
    { word: "suspect", definition: "ÊÄÄÁñëÔºõÁåúÊÉ≥" },
    { word: "harvest", definition: "Êî∂Ëé∑ÔºõÊî∂Êàê" },
    { word: "achievement", definition: "ÊàêÂ∞±ÔºõÂäüÁª©" },
    { word: "purchase", definition: "Ë¥≠‰π∞" },
    { word: "convenient", definition: "Êñπ‰æøÁöÑÔºõ‰æøÂà©ÁöÑ" },
    { word: "credit", definition: "‰ø°Áî®ÔºõÂ≠¶ÂàÜÔºõËµûÊâ¨" },
    { word: "peer", definition: "ÂêåÈæÑ‰∫∫ÔºõÂêå‰º¥" },
    { word: "ignore", definition: "ÂøΩÁï•Ôºõ‰∏çÁêÜ‰ºö" },
    { word: "recite", definition: "ËÉåËØµ" },
    { word: "benefit", definition: "ÁõäÂ§ÑÔºõÂ•ΩÂ§Ñ" },
    { word: "stare", definition: "ÁõØÁùÄÁúãÔºõÂáùËßÜ" },
    { word: "obey", definition: "Êúç‰ªéÔºõÈÅµÂÆà" },
    { word: "scholar", definition: "Â≠¶ËÄÖ" },
    { word: "enrich", definition: "‰∏∞ÂØåÔºõÂÖÖÂÆû" },
    { word: "origin", definition: "Ëµ∑Ê∫êÔºõÂá∫Ë∫´" },
    { word: "journal", definition: "ÊúüÂàäÔºõÊùÇÂøó" },
    { word: "profit", definition: "Âà©Ê∂¶ÔºõÁõäÂ§Ñ" },
    { word: "obtain", definition: "Ëé∑ÂæóÔºõÂæóÂà∞" },
    { word: "maximum", definition: "ÊúÄÂ§ßÁöÑÔºõÊúÄÈ´òÁöÑ" },
    { word: "erupt", definition: "ÁàÜÂèëÔºõÂñ∑Âá∫" },
    { word: "common", definition: "ÂÖ±ÂêåÁöÑÔºõÊôÆÈÄöÁöÑ" },
    { word: "apparent", definition: "ÊòéÊòæÁöÑÔºõË°®Èù¢ÁöÑ" },
    { word: "climate", definition: "Ê∞îÂÄôÔºõÊ∞õÂõ¥" },
    { word: "bend", definition: "ÂºØÊõ≤ÔºõÂ±àÊúç" },
    { word: "represent", definition: "‰ª£Ë°®ÔºõË±°ÂæÅ" },
    { word: "source", definition: "Êù•Ê∫êÔºõÊ†πÊ∫ê" },
    { word: "career", definition: "ËÅå‰∏öÔºõ‰∫ã‰∏ö" },
    { word: "consequence", definition: "ÁªìÊûúÔºõÂêéÊûú" },
    { word: "inspect", definition: "Ê£ÄÊü•ÔºõËßÜÂØü" },
    { word: "appoint", definition: "‰ªªÂëΩÔºõÊåáÂÆö" },
    { word: "tradition", definition: "‰º†ÁªüÔºõÊÉØ‰æã" },
    { word: "investigate", definition: "Ë∞ÉÊü•ÔºõÁ†îÁ©∂" },
    { word: "loss", definition: "ÊçüÂ§±Ôºõ‰∏ßÂ§±" },
    { word: "agent", definition: "‰ª£ÁêÜ‰∫∫Ôºõ‰∏≠‰ªã" },
    { word: "strip", definition: "Ââ•ÂéªÔºõËÑ±Âéª" }, 
    { word: "struggle", definition: "Â•ãÊñóÔºõÊå£Êâé" },
    { word: "otherwise", definition: "Âê¶ÂàôÔºõ‰∏çÁÑ∂" },
    { word: "grateful", definition: "ÊÑüÊøÄÁöÑÔºõÊÑüË∞¢ÁöÑ" },
    { word: "affair", definition: "‰∫ãÂä°Ôºõ‰∫ãÊÉÖ" },
    { word: "cater", definition: "Êèê‰æõÈ•ÆÈ£üÔºõÊª°Ë∂≥ÈúÄÊ±Ç" },
    { word: "adventure", definition: "ÂÜíÈô©ÔºõÂ•áÈÅá" },
    { word: "spare", definition: "Â§áÁî®ÁöÑÔºõÁ©∫Èó≤ÁöÑ" },
    { word: "preserve", definition: "‰øùÊä§Ôºõ‰øùËóè" },
    { word: "bond", definition: "ËÅîÁªìÔºõÁ∫ΩÂ∏¶ÔºõÂÄ∫Âà∏" },
    { word: "mission", definition: "‰ªªÂä°Ôºõ‰ΩøÂëΩ" },
    { word: "character", definition: "ÊÄßÊ†ºÔºõÁâπÂæÅÔºõ‰∫∫Áâ©" },
    { word: "absorb", definition: "Âê∏Êî∂ÔºõÂê∏Âºï" },
    { word: "regulation", definition: "ËßÑÂÆöÔºõÊù°‰æã" },
    { word: "condition", definition: "Êù°‰ª∂ÔºõÁä∂ÂÜµ" },
    { word: "examine", definition: "Ê£ÄÊü•ÔºõËÄÉËØï" },
    { word: "campus", definition: "Ê†°Âõ≠" },
    { word: "conduct", definition: "ÁªÑÁªáÔºõÂÆûÊñΩÔºõÂºïÂØº" },
    { word: "beneath", definition: "Âú®...‰∏ãÊñπÔºõ‰Ωé‰∫é" },
    { word: "occasion", definition: "Êó∂ÂàªÔºõÂú∫Âêà" },
    { word: "brand", definition: "ÂìÅÁâåÔºõÂïÜÊ†á" },
    { word: "sweat", definition: "Ê±óÊ∞¥" },
    { word: "prison", definition: "ÁõëÁã±" },
    { word: "anniversary", definition: "Âë®Âπ¥Á∫™ÂøµÊó•" }, 
    { word: "essential", definition: "ÂøÖË¶ÅÁöÑÔºõÊú¨Ë¥®ÁöÑ" },
    { word: "couple", definition: "Â§´Â¶ªÔºõ‰∏ÄÂØπ" },
    { word: "selfish", definition: "Ëá™ÁßÅÁöÑ" },
    { word: "ongoing", definition: "ÊåÅÁª≠ÁöÑÔºõËøõË°å‰∏≠ÁöÑ" },
    { word: "bear", definition: "ÂøçÂèóÔºõÊâøÊãÖÔºõÁîüËÇ≤" },
    { word: "welfare", definition: "Á¶èÂà©ÔºõÂπ∏Á¶è" },
    { word: "participate", definition: "ÂèÇÂä†ÔºõÂèÇ‰∏é" },
    { word: "feature", definition: "ÁâπÂæÅÔºõÁâπËâ≤" },
    { word: "fix", definition: "Âõ∫ÂÆöÔºõ‰øÆÁêÜ" },
    { word: "depression", definition: "ÊäëÈÉÅÔºõËêßÊù°" },
    { word: "occupy", definition: "Âç†ÊçÆÔºõ‰ΩøÂøôÁ¢å" },
    { word: "merely", definition: "‰ªÖ‰ªÖÔºõÂè™‰∏çËøá" },
    { word: "solar", definition: "Â§™Èò≥ÁöÑÔºõÂ§™Èò≥ËÉΩÁöÑ" },
    { word: "despite", definition: "Â∞ΩÁÆ°ÔºõËôΩÁÑ∂" },
    { word: "adequate", definition: "Ë∂≥Â§üÁöÑÔºõÈÄÇÂΩìÁöÑ" },
    { word: "moreover", definition: "ËÄå‰∏îÔºõÊ≠§Â§ñ" },
    { word: "shoulder", definition: "ËÇ©Ë¥üÔºõÊâøÊãÖ" },
    { word: "astonished", definition: "ÊÉäÂ•áÁöÑÔºõÊÉäËÆ∂ÁöÑ" },
    { word: "adopt", definition: "ÈááÁ∫≥ÔºõÊî∂ÂÖª" },
    { word: "core", definition: "Ê†∏ÂøÉÔºõË¶ÅÁÇπ" },
    { word: "witness", definition: "ÁõÆÂáªÔºõ‰ΩúËØÅ" },
    { word: "in vain", definition: "ÂæíÂä≥Âú∞ÔºõÁôΩË¥πÂäõÊ∞îÂú∞" },
    { word: "wound", definition: "‰º§Âè£ÔºõÂàõ‰º§" },
    { word: "block", definition: "ÈòªÁ¢çÔºõÂ†µÂ°û" },
    { word: "approve", definition: "ÊâπÂáÜÔºõËµûÊàê" },
    { word: "entire", definition: "Êï¥‰∏™ÁöÑÔºõÂÖ®ÈÉ®ÁöÑ" },
    { word: "heritage", definition: "ÈÅó‰∫ßÔºõ‰º†Áªü" },
    { word: "postpone", definition: "Êé®ËøüÔºõÂª∂Êúü" },
    { word: "acquire", definition: "Ëé∑ÂæóÔºõÂèñÂæó" },
    { word: "adapt", definition: "ÈÄÇÂ∫îÔºõÊîπÁºñ" },
    { word: "encourage", definition: "ÈºìÂä±Ôºõ‰øÉËøõ" },
    { word: "victim", definition: "ÂèóÂÆ≥ËÄÖÔºõÁâ∫Áâ≤ÂìÅ" },
    { word: "raw", definition: "ÁîüÁöÑÔºõÊú™Âä†Â∑•ÁöÑ" },
    { word: "display", definition: "Â±ïÁ§∫ÔºõÈôàÂàó" },
    { word: "curiosity", definition: "Â•ΩÂ•áÂøÉ" }
    ];

    let selectedWord = null; 
    let matchedPairs = new Map(); 
    let quizStartTime; 
    let quizEndTime; 
    let timerInterval; 
    const totalWords = 15; // ÊØèÊ¨°ÊµãÈ™åÁöÑÂçïËØçÈáè
    const totalTime = 240; // ÊµãÈ™åÊÄªÊó∂Èó¥‰∏∫ 4 ÂàÜÈíü (240 Áßí)
    let remainingTime = totalTime; 
    let quizActive = false; 
    let nameInput = document.getElementById('studentName'); 
    let wordsInCurrentQuiz = []; 

    // Function to initialize or reset the quiz
    function initQuiz() {
        // Clear existing elements
        document.getElementById('wordColumn').innerHTML = '';
        document.getElementById('definitionColumn').innerHTML = '';
        matchedPairs.clear();
        selectedWord = null;
        wordsInCurrentQuiz = []; 
        document.getElementById('submitButton').classList.remove('bg-green-500', 'hover:bg-green-600', 'text-white');
        document.getElementById('submitButton').classList.add('bg-gray-300', 'text-gray-700');
        document.getElementById('submitButton').disabled = true; // Disable submit button initially

        // Set current date heading
        document.getElementById('dateHeading').textContent = 'Comprehensive1-1';

        // Randomly select 15 words and their definitions
        const selectedWordsData = shuffleArray(vocabulary).slice(0, totalWords); // ‰ΩøÁî® totalWords Â∏∏Èáè
        wordsInCurrentQuiz = selectedWordsData; 
        const correctDefinitionsData = selectedWordsData.map(item => item.definition);

        // Randomly select 0 distractor definitions (as per your previous instruction)
        const extraDefinitionsData = shuffleArray(vocabulary)
            .filter(item => !correctDefinitionsData.includes(item.definition)) 
            .slice(0, 0)
            .map(item => item.definition);

        // Combine all definitions (15 correct + 0 distractors) and shuffle them
        const allDefinitions = shuffleArray([...correctDefinitionsData, ...extraDefinitionsData]);

        // Display words in the word column
        selectedWordsData.forEach(item => {
            const div = document.createElement('div');
            div.className = 'word p-3 mb-2 rounded-lg cursor-pointer transition-all duration-200 ease-in-out ' +
                                 'bg-yellow-200 hover:bg-yellow-300 shadow-sm border border-yellow-300';
            div.textContent = item.word;
            div.dataset.definition = item.definition; // Store correct definition for checking
            div.addEventListener('click', handleWordClick);
            div.addEventListener('dblclick', handleWordDoubleClick);
            document.getElementById('wordColumn').appendChild(div);
        });

        // Display definitions in the definition column
        allDefinitions.forEach(definition => {
            const div = document.createElement('div');
            div.className = 'definition p-3 mb-2 rounded-lg cursor-pointer transition-all duration-200 ease-in-out ' +
                                 'bg-blue-200 hover:bg-blue-300 shadow-sm border border-blue-300';
            div.textContent = definition;
            div.addEventListener('click', handleDefinitionClick);
            div.addEventListener('dblclick', handleDefinitionDoubleClick); // Double-click handler for definitions
            document.getElementById('definitionColumn').appendChild(div);
        });

        // Start the timer
        startTimer();
        quizActive = true;
    }

    // Handles click on a word element
    function handleWordClick(e) {
        if (!quizActive) return; 
        const word = e.target;
        if (word.classList.contains('bg-pink-300')) return;

        if (selectedWord) {
            selectedWord.classList.remove('bg-green-400', 'border-green-500'); 
            selectedWord.classList.add('bg-yellow-200', 'border-yellow-300'); 
        }
        
        selectedWord = word;
        selectedWord.classList.add('bg-green-400', 'border-green-500'); 
        selectedWord.classList.remove('bg-yellow-200', 'border-yellow-300'); 
    }

    // Handles double-click on a word element (for unmatching/deselecting)
    function handleWordDoubleClick(e) {
        if (!quizActive) return; 
        e.preventDefault();
        const word = e.target;
        unmatchElement(word, 'word');
    }

    // Handles double-click on a definition element (for unmatching)
    function handleDefinitionDoubleClick(e) {
        if (!quizActive) return; 
        e.preventDefault();
        const definition = e.target;
        unmatchElement(definition, 'definition');
    }

    // Helper function to unmatch an element (word or definition)
    function unmatchElement(element, type) {
        if (type === 'word' && element.classList.contains('bg-pink-300')) {
            const definition = matchedPairs.get(element);
            if (definition) {
                definition.classList.remove('bg-pink-300', 'border-pink-400', 'cursor-default');
                definition.classList.add('bg-blue-200', 'hover:bg-blue-300', 'border-blue-300', 'cursor-pointer');
                matchedPairs.delete(element);
            }
            // Restore word style
            element.classList.remove('bg-pink-300', 'border-pink-400', 'cursor-default', 'bg-green-400', 'border-green-500');
            element.classList.add('bg-yellow-200', 'hover:bg-yellow-300', 'border-yellow-300', 'cursor-pointer');
            selectedWord = null; // Clear selected word
        } else if (type === 'definition' && element.classList.contains('bg-pink-300')) {
            let wordToRemove = null;
            for (const [word, definition] of matchedPairs.entries()) {
                if (definition === element) {
                    wordToRemove = word;
                    break;
                }
            }
            if (wordToRemove) {
                // Restore word style
                wordToRemove.classList.remove('bg-pink-300', 'border-pink-400', 'cursor-default', 'bg-green-400', 'border-green-500');
                wordToRemove.classList.add('bg-yellow-200', 'hover:bg-yellow-300', 'border-yellow-300', 'cursor-pointer');
                matchedPairs.delete(wordToRemove);
            }
            // Restore definition style
            element.classList.remove('bg-pink-300', 'border-pink-400', 'cursor-default');
            element.classList.add('bg-blue-200', 'hover:bg-blue-300', 'border-blue-300', 'cursor-pointer');
            selectedWord = null; // Clear selected word
        } else if (type === 'word') {
            // If not matched, deselect the word (remove green highlight)
            element.classList.remove('bg-green-400', 'border-green-500');
            element.classList.add('bg-yellow-200', 'border-yellow-300');
            selectedWord = null;
        }
        checkCompletion(); 
    }

    // Handles click on a definition element
    function handleDefinitionClick(e) {
        if (!quizActive) return; 
        const definition = e.target;
        if (definition.classList.contains('bg-pink-300')) return;

        if (selectedWord) {
            selectedWord.classList.remove('bg-green-400', 'border-green-500');

            // Apply 'matched' styling to both word and definition
            selectedWord.classList.add('bg-pink-300', 'border-pink-400', 'cursor-default');
            definition.classList.add('bg-pink-300', 'border-pink-400', 'cursor-default');
            
            // Remove hover effects for matched items
            selectedWord.classList.remove('hover:bg-yellow-300');
            definition.classList.remove('hover:bg-blue-300');

            // Store the matched pair
            matchedPairs.set(selectedWord, definition);
            selectedWord = null; // Clear selected word
        }
        checkCompletion(); 
    }

    // Checks if all words have been matched and updates submit button state
    function checkCompletion() {
        const words = document.querySelectorAll('#wordColumn .word');
        const allWordsMatched = Array.from(words).every(word => word.classList.contains('bg-pink-300'));
        const submitButton = document.getElementById('submitButton');

        if (allWordsMatched && quizActive) {
            submitButton.classList.remove('bg-gray-300', 'text-gray-700', 'cursor-not-allowed');
            submitButton.classList.add('bg-green-500', 'hover:bg-green-600', 'text-white', 'cursor-pointer');
            submitButton.disabled = false;
        } else {
            submitButton.classList.add('bg-gray-300', 'text-gray-700', 'cursor-not-allowed');
            submitButton.classList.remove('bg-green-500', 'hover:bg-green-600', 'text-white');
            submitButton.disabled = true;
        }
    }

    // Handles quiz submission
    function submitQuiz() {
        if (!quizActive) return; 

        const studentName = nameInput.value.trim();
        if (!studentName) {
            showMessage('Missing Information', 'Please enter your name before submitting the quiz.');
            return;
        }

        // Stop the timer
        clearInterval(timerInterval);
        quizEndTime = new Date();
        quizActive = false; // Deactivate quiz
        document.getElementById('submitButton').disabled = true; // Also disable button on submission

        // Calculate time
        let timeDiffSeconds;
        if (quizStartTime) {
            timeDiffSeconds = Math.floor((quizEndTime - quizStartTime) / 1000); 
        } else {
            timeDiffSeconds = totalTime - remainingTime;
        }
        
        const minutes = Math.floor(timeDiffSeconds / 60);
        const seconds = Math.floor(timeDiffSeconds % 60); 

        let correctCount = 0;
        let totalWordsInQuiz = 0; 
        let incorrectAnswersList = "";

        document.querySelectorAll('#wordColumn .word').forEach(wordElement => {
            totalWordsInQuiz++;
            const correctDefinition = wordElement.dataset.definition;
            let isCorrect = false;

            // Check if this word was matched and if the match is correct
            if (matchedPairs.has(wordElement)) {
                const matchedDefinitionElement = matchedPairs.get(wordElement);
                if (matchedDefinitionElement.textContent === correctDefinition) {
                    correctCount++;
                    isCorrect = true;
                }
            } 
            
            // If the answer is INCORRECT (or unmatched), add it to the list of incorrect answers
            if (!isCorrect) {
                // Find the original word object from the full list (to get word and correct definition)
                const wordObj = wordsInCurrentQuiz.find(item => item.word === wordElement.textContent);
                if (wordObj) {
                    // Format: "Word should be matched with Definition"
                    incorrectAnswersList += `${wordObj.word} should be matched with ${wordObj.definition}\n`;
                }
            }
        });

        // Calculate accuracy
        const accuracy = (correctCount / totalWordsInQuiz) * 100;

        const pageTitle = document.getElementById('dateHeading').textContent; 
        const submitTime = quizEndTime.toLocaleTimeString('en-US', { hour12: false, year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', second: '2-digit' }).replace(/, /g, ' ').replace(/\//g, '-');
        
        // Determine the message for incorrect answers section
        let incorrectMessage;
        if (incorrectAnswersList) {
            incorrectMessage = `
---

<h3>Incorrect Matches & Correct Answers (ÈîôÈ¢ò‰∏éÊ≠£Á°ÆÂåπÈÖç):</h3>
${incorrectAnswersList}
            `;
        } else {
            incorrectMessage = `
---

<h3>Incorrect Matches: ü•≥ All correct! (ÈîôÈ¢ò: ü•≥ ÂÖ®ÈÉ®Ê≠£Á°Æ!)</h3>
            `;
        }

        // Construct the result message for the modal
        let resultMessage = `
Page Title: ${pageTitle}
Submission Time: ${submitTime}
Student Name: ${studentName}
Completion Time: ${timeDiffSeconds}s (${minutes}m ${seconds}s)
Correct Matches: ${correctCount}/${totalWordsInQuiz}
Accuracy: ${accuracy.toFixed(2)}%
${incorrectMessage}
        `;

        showMessage('Quiz Results (ÊµãÈ™åÁªìÊûú)', resultMessage);
    } 

    // Starts the countdown timer
    function startTimer() {
        clearInterval(timerInterval); 
        remainingTime = totalTime; 
        updateTimerDisplay(); 
        quizStartTime = new Date(); 
        
        timerInterval = setInterval(() => {
            remainingTime--;
            updateTimerDisplay();

            if (remainingTime <= 0) {
                clearInterval(timerInterval);
                showMessage('Time\'s Up!', 'Your time has run out. The quiz has been automatically submitted.');
                // Use a slight delay to ensure modal shows before submitQuiz runs
                setTimeout(submitQuiz, 100); 
            }
        }, 1000);
    }

    // Updates the timer display
    function updateTimerDisplay() {
        const minutes = Math.floor(remainingTime / 60);
        const seconds = remainingTime % 60;
        document.getElementById('timer').textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }

    // Shuffles an array (Fisher-Yates algorithm)
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]]; // Swap elements
        }
        return array;
    }

    // **MODIFIED: Displays a custom modal message using innerHTML and replacing \n with <br>**
    function showMessage(title, message) {
        document.getElementById('modalTitle').textContent = title;
        
        // Replace \n with <br> and use innerHTML to ensure line breaks are displayed correctly
        // I also replace '---' with an actual <hr> for visual separation.
        const formattedMessage = message.replace(/\n/g, '<br>').replace(/---/g, '<hr>');

        document.getElementById('modalMessage').innerHTML = formattedMessage; 

        // Clear previous buttons from the modal content if they are not the default 'Close' button
        const modalContentDiv = document.getElementById('customModal').querySelector('.modal-content');
        let existingButtons = modalContentDiv.querySelectorAll('button');
        existingButtons.forEach(button => {
            // Keep only the 'Close' button for regular messages, remove confirm/cancel buttons
            if (button.textContent !== 'Close') {
                button.remove();
            }
        });
        // Re-add the default 'Close' button if it was removed or isn't there
        if (!modalContentDiv.querySelector('button[onclick="closeModal()"]')) {
            const closeButton = document.createElement('button');
            closeButton.textContent = 'Close';
            closeButton.className = 'px-6 py-3 bg-blue-500 text-white font-semibold rounded-lg shadow-md transition-all duration-300 ease-in-out hover:bg-blue-600 focus:outline-none focus:ring-4 focus:ring-blue-300 text-lg';
            closeButton.onclick = closeModal;
            modalContentDiv.appendChild(closeButton);
        }
        document.getElementById('customModal').classList.remove('hidden'); // Show the modal
    }

    // Closes the custom modal message
    function closeModal() {
        document.getElementById('customModal').classList.add('hidden'); // Hide the modal
    }

    // Resets the quiz to its initial state
    function resetQuiz() {
        // Modify modal to include confirmation buttons for reset
        const modalMessageDiv = document.getElementById('modalMessage');
        // Use innerHTML for reset confirmation message
        modalMessageDiv.innerHTML = 'Are you sure you want to reset the quiz? Your current progress will be lost.';
                                     
        const modalContentDiv = document.getElementById('customModal').querySelector('.modal-content');
        
        // Remove existing buttons
        Array.from(modalContentDiv.querySelectorAll('button')).forEach(btn => btn.remove());

        // Add confirm and cancel buttons for the reset action
        const confirmButton = document.createElement('button');
        confirmButton.textContent = 'Yes, Reset';
        confirmButton.className = 'px-6 py-3 bg-red-500 text-white font-semibold rounded-lg shadow-md transition-all duration-300 ease-in-out hover:bg-red-600 focus:outline-none focus:ring-4 focus:ring-red-300 text-lg mr-2';
        confirmButton.onclick = () => {
            clearInterval(timerInterval); // Stop timer
            initQuiz(); // Re-initialize everything
            closeModal(); // Close the confirmation modal
        };

        const cancelButton = document.createElement('button');
        cancelButton.textContent = 'Cancel';
        cancelButton.className = 'px-6 py-3 bg-gray-300 text-gray-700 font-semibold rounded-lg shadow-md transition-all duration-300 ease-in-out hover:bg-gray-400 focus:outline-none focus:ring-4 focus:ring-gray-200 text-lg';
        cancelButton.onclick = closeModal;

        modalContentDiv.appendChild(confirmButton);
        modalContentDiv.appendChild(cancelButton);
        document.getElementById('modalTitle').textContent = 'Confirm Reset';
        document.getElementById('customModal').classList.remove('hidden');
    }

    // Initialize quiz when the window loads
    window.onload = initQuiz;
</script>
</body>
</html>
