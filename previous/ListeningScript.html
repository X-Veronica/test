<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€æ˜“å­—å¹•æ’­æ”¾å™¨</title>
    <style>
        body {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            height: 100vh;
            box-sizing: border-box;
        }

        h2 { color: #333; }

        /* æ§åˆ¶åŒºåŸŸæ ·å¼ */
        .controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 600px;
            margin-bottom: 20px;
            text-align: center;
        }

        .input-group { margin-bottom: 15px; text-align: left; }
        label { font-weight: bold; display: block; margin-bottom: 5px; }
        textarea { width: 100%; height: 100px; border: 1px solid #ccc; border-radius: 5px; padding: 8px; box-sizing: border-box; font-family: monospace;}
        input[type="file"] { margin-top: 5px; }

        /* éŸ³é¢‘æ’­æ”¾å™¨æ ·å¼ */
        audio { width: 100%; margin-top: 10px; outline: none; }

        /* å­—å¹•æ˜¾ç¤ºåŒºåŸŸæ ·å¼ */
        #lyrics-container {
            flex-grow: 1;
            width: 100%;
            max-width: 600px;
            background: #222;
            color: #888; /* æœªæ¿€æ´»æ­Œè¯é¢œè‰² */
            border-radius: 10px;
            padding: 20px;
            overflow-y: auto; /* å…è®¸æ»šåŠ¨ */
            text-align: center;
            position: relative;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
            scroll-behavior: smooth;
        }

        .lyric-line {
            padding: 10px 5px;
            font-size: 18px;
            transition: all 0.3s ease;
            cursor: pointer;
            line-height: 1.5;
        }

        .lyric-line:hover { color: #bbb; }

        /* é«˜äº®æ ·å¼ - å¡æ‹‰OKæ•ˆæœ */
        .lyric-line.active {
            color: #fff;          /* é«˜äº®æ–‡å­—é¢œè‰² */
            font-size: 22px;      /* æ”¾å¤§å½“å‰è¡Œ */
            font-weight: bold;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.6); /* é‡‘è‰²å…‰æ™• */
            transform: scale(1.05);
        }

        /* éšè—æ»šåŠ¨æ¡ä½†ä¿ç•™åŠŸèƒ½ */
        #lyrics-container::-webkit-scrollbar { width: 8px; }
        #lyrics-container::-webkit-scrollbar-track { background: #333; }
        #lyrics-container::-webkit-scrollbar-thumb { background: #555; border-radius: 4px; }
    </style>
</head>
<body>

    <h2>ğŸ¤ è‹±è¯­è·Ÿè¯»æ’­æ”¾å™¨</h2>

    <div class="controls">
        <div class="input-group">
            <label>1. é€‰æ‹©éŸ³é¢‘æ–‡ä»¶ (mp3/wav):</label>
            <input type="file" id="audioFile" accept="audio/*">
        </div>
        
        <div class="input-group">
            <label>2. ç²˜è´´å¸¦æ—¶é—´æˆ³çš„æ–‡æœ¬ (LRCæ ¼å¼):</label>
            <textarea id="lrcInput" placeholder="[00:00.00] ç²˜è´´ä½ çš„å­—å¹•å†…å®¹...&#10;[00:01.50] ç¬¬ä¸€å¥æ­Œè¯..."></textarea>
        </div>

        <button onclick="loadLyrics()" style="padding: 8px 20px; background:#007bff; color:white; border:none; border-radius:5px; cursor:pointer;">åŠ è½½å­—å¹•</button>
        
        <audio id="player" controls></audio>
    </div>

    <div id="lyrics-container">
        <p style="margin-top: 50px;">è¯·åŠ è½½éŸ³é¢‘å’Œå­—å¹•...</p>
    </div>

    <script>
        const player = document.getElementById('player');
        const audioInput = document.getElementById('audioFile');
        const lrcInput = document.getElementById('lrcInput');
        const lyricsContainer = document.getElementById('lyrics-container');
        
        let lyricsData = []; // å­˜å‚¨è§£æåçš„æ­Œè¯å¯¹è±¡ {time, text}

        // ç›‘å¬éŸ³é¢‘æ–‡ä»¶ä¸Šä¼ 
        audioInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const url = URL.createObjectURL(file);
                player.src = url;
            }
        });

        // è§£æ LRC æ ¼å¼
        function parseLRC(lrcString) {
            const lines = lrcString.split('\n');
            const result = [];
            // æ­£åˆ™åŒ¹é…æ—¶é—´æˆ³ [mm:ss.xx]
            const timeReg = /\[(\d{2}):(\d{2})(\.\d{2,3})?\]/;

            lines.forEach(line => {
                const match = timeReg.exec(line);
                if (match) {
                    // è½¬æ¢ä¸ºç§’
                    const min = parseInt(match[1]);
                    const sec = parseInt(match[2]);
                    const ms = match[3] ? parseFloat(match[3]) : 0;
                    const time = min * 60 + sec + ms;
                    const text = line.replace(timeReg, '').trim();
                    
                    if (text) {
                        result.push({ time, text });
                    }
                }
            });
            return result;
        }

        // åŠ è½½å­—å¹•åˆ°ç•Œé¢
        function loadLyrics() {
            const rawText = lrcInput.value;
            lyricsData = parseLRC(rawText);
            
            lyricsContainer.innerHTML = ''; // æ¸…ç©ºæ—§æ­Œè¯
            
            if (lyricsData.length === 0) {
                lyricsContainer.innerHTML = '<p>æœªæ£€æµ‹åˆ°æœ‰æ•ˆçš„æ—¶é—´æˆ³å­—å¹•ã€‚</p>';
                return;
            }

            lyricsData.forEach((line, index) => {
                const div = document.createElement('div');
                div.className = 'lyric-line';
                div.dataset.index = index; // å­˜å‚¨ç´¢å¼•ä»¥ä¾¿ç‚¹å‡»è·³è½¬
                div.innerText = line.text;
                
                // ç‚¹å‡»æ­Œè¯è·³è½¬è¿›åº¦
                div.addEventListener('click', () => {
                    player.currentTime = line.time;
                    player.play();
                });

                lyricsContainer.appendChild(div);
            });
        }

        // å®æ—¶åŒæ­¥é€»è¾‘
        player.addEventListener('timeupdate', () => {
            const currentTime = player.currentTime;
            
            // æ‰¾åˆ°å½“å‰æ—¶é—´å¯¹åº”çš„é‚£ä¸€è¡Œ
            // é€»è¾‘ï¼šæ‰¾åˆ°æœ€åä¸€è¡Œ å®ƒçš„æ—¶é—´ <= å½“å‰æ—¶é—´
            let activeIndex = -1;
            for (let i = 0; i < lyricsData.length; i++) {
                if (currentTime >= lyricsData[i].time) {
                    activeIndex = i;
                } else {
                    break; // å› ä¸ºæ—¶é—´æ˜¯æ’åºçš„ï¼Œåé¢çš„ä¸€å®šæ›´å¤§ï¼Œä¸ç”¨çœ‹äº†
                }
            }

            highlightLine(activeIndex);
        });

        function highlightLine(index) {
            // ç§»é™¤æ‰€æœ‰é«˜äº®
            const lines = document.querySelectorAll('.lyric-line');
            lines.forEach(line => line.classList.remove('active'));

            if (index !== -1 && lines[index]) {
                const activeLine = lines[index];
                activeLine.classList.add('active');

                // è‡ªåŠ¨æ»šåŠ¨ï¼šä¿æŒé«˜äº®è¡Œåœ¨å®¹å™¨ä¸­é—´
                activeLine.scrollIntoView({
                    behavior: 'smooth',
                    block: 'center'
                });
            }
        }
    </script>
</body>
</html>
